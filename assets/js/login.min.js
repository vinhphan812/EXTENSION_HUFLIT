const DOM=document.getElementById("DOM"),Menu=document.getElementById("menu"),main=document.getElementById("main"),inpUser=document.getElementById("user"),inpPass=document.getElementById("pass"),host="https://api-huflit-server.herokuapp.com/";var LoginUser,LoginPass,xhr=new XMLHttpRequest;function checkCookie(e){try{var n="cookie="+e;isDisabled(!0),xhr.addEventListener("readystatechange",resCookie),xhrRequest("checkCookie",n)}catch(e){inputLogin()}}function resCookie(e){document.getElementById("msg");if(4===this.readyState){var n=JSON.parse(this.responseText);n.isDone?isDone(n.name):chrome.storage.local.get(["user","pass"],function(e){if(!e.user||!e.pass)return isDisabled(!1),void stopLoading();Login(e.user,e.pass)})}}function Login(e,n){const t=document.getElementById("msg");if(LoginUser=e||inpUser.value,LoginPass=n||inpPass.value,t&&(t.innerText=""),isDisabled(!0),""==LoginUser||""==LoginPass)return isDisabled(!1),void(t.innerText="Enter user or pass");var o="user="+LoginUser+"&pass="+LoginPass;xhr.removeEventListener("readystatechange",resCookie),xhr.addEventListener("readystatechange",DOMLogin),xhrRequest("profile",o)}function inputLogin(){document.getElementById("login").addEventListener("click",function(e){Login()}),document.addEventListener("keyup",function(e){"Enter"==e.key&&Login()}),stopLoading()}function Logout(){chrome.storage.local.remove(["user","pass","cookie"],function(){console.log("success")}),window.location.href="popup.html"}function xhrRequest(e,n){xhr.open("POST",host+e),xhr.setRequestHeader("Access-Control-Allow-Origin","*"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Accept-Language","vi,en;q=0.9,vi-VN;q=0.8"),xhr.send(n)}function DOMLogin(e){const n=document.getElementById("msg");if(4===this.readyState){var t=JSON.parse(this.responseText);t.isDone?chrome.storage.local.set({cookie:t.cookie,user:LoginUser,pass:LoginPass},function(){console.log("save success"),isDone(t.name)}):(isDisabled(!1),n.innerText=t.msg)}}function isDisabled(e){inpUser.disabled=e,inpPass.disabled=e,document.getElementById("login").disabled=e}function stopLoading(){main.style.filter="none",main.style.opacity=1,document.getElementById("loader").remove(),DOM.style.opacity=1,DOM.style.transform="translateY(0px)"}chrome.storage.local.get(["cookie"],function(e){e.cookie?(main.style.opacity=.5,main.style.filter="blur(1px)",checkCookie(e.cookie)):inputLogin()});