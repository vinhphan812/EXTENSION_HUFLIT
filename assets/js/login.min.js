const DOM=document.getElementById("DOM"),Menu=document.getElementById("menu"),main=document.getElementById("main"),inpUser=document.getElementById("user"),inpPass=document.getElementById("pass"),host="https://api-huflit-server.herokuapp.com";var LoginUser,LoginPass,xhr=new XMLHttpRequest;function checkCookie(e){try{var n="cookie="+e;isDisabled(!0),xhr.addEventListener("readystatechange",resCookie),xhrRequest("checkCookie",n)}catch(e){inputLogin()}}function resCookie(e){document.getElementById("msg");if(4===this.readyState){var n=JSON.parse(this.responseText);n.isDone?isDone(n.name):chrome.storage.local.get(["user","pass"],function(e){if(!e.user||!e.pass)return isDisabled(!1),void stopLoading();Login(e.user,e.pass)})}}function Login(e,n){const o=document.getElementById("msg");if(LoginUser=e||inpUser.value,LoginPass=n||inpPass.value,o&&(o.innerText=""),isDisabled(!0),""==LoginUser||""==LoginPass)return isDisabled(!1),void(o.innerText="Enter user or pass");var t="user="+LoginUser+"&pass="+LoginPass;xhr.removeEventListener("readystatechange",resCookie),xhr.addEventListener("readystatechange",DOMLogin),xhrRequest("profile",t)}function inputLogin(){document.getElementById("login").addEventListener("click",function(e){Login()}),document.addEventListener("keyup",function(e){"Enter"==e.key&&Login()}),stopLoading()}function Logout(){chrome.storage.local.remove(["user","pass","cookie"],function(){console.log("success")}),window.location.href="popup.html"}chrome.storage.local.get(["cookie"],function(e){e.cookie?(main.style.opacity=.5,main.style.filter="blur(1px)",checkCookie(e.cookie)):inputLogin()});